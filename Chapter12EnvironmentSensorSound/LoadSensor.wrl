#VRML V2.0 utf8
# X3D-to-VRML-97 XSL translation autogenerated by X3dToVrml97.xslt
# https://www.web3d.org/x3d/content/X3dToVrml97.xslt
# Generated using XSLT processor: Saxonica

# [X3D] VRML V3.3 utf8
# PROFILE Immersive
# [X3D] version=3.3
# [X3D] noNamespaceSchemaLocation=http://www.web3d.org/specifications/x3d-3.3.xsd
# [head]

# META "title" "LoadSensor.x3d"
# META "description" "Simple test of LoadSensor node"
# META "creator" "Don Brutzman"
# META "created" "17 July 2008"
# META "modified" "20 October 2019"
# META "rights" "Copyright Don Brutzman and Leonard Daly 2008"
# META "subject" "X3D LoadSensor example"
# META "identifier" "http://X3dGraphics.com/examples/X3dForWebAuthors/Chapter12EnvironmentSensorSound/LoadSensor.x3d"
# META "generator" "X3D-Edit 3.3, https://savage.nps.edu/X3D-Edit"
# META "license" "../license.html"


EXTERNPROTO LoadSensor [
  # [appinfo] LoadSensor monitors the progress and success of downloading URL elements over a network. Only nodes that contain a valid URL field (i.e., descendants of X3DUrlObject), may be specified as watchList children. Multiple nodes may be watched with a single LoadSensor.
  # documentation: https://www.web3d.org/specifications/ISO-IEC-19775/Part01/components/networking.html#LoadSensor exposedField SFBool enabled # [appinfo] Enables/disables the sensor node.
  exposedField SFTime timeOut # [appinfo] Maximum time for which the LoadSensor will monitor loading, starting from when the sensor becomes active. timeOut=0 ordinarily indicates an indefinite time out period; i.e., the LoadSensor will wait until loading has completed either with success or failure timeOut=0 causes immediate loading for this implementation.
  field MFNode watchList # [appinfo] Zero or more nodes with url fields to monitor.
  eventIn MFNode set_watchList # [appinfo] Change watchList MFNode array.
  eventOut SFBool isActive # [appinfo] isActive=true when loading begins, isActive=false when loading ends.
  eventOut SFBool isLoaded # [appinfo] isLoaded=true when loading succeeds, isLoaded=false when loading fails or timeOut reached.
  eventOut SFTime loadTime # [appinfo] loadTime event is generated when loading has successfully completed.
  eventOut SFFloat progress # [appinfo] progress [0..1] indicates fraction of loading complete.
  field SFNode metadata # [appinfo] associated Metadata node.
][
  "LoadSensorPrototype.wrl#LoadSensor"
  "https://www.web3d.org/x3d/content/examples/Basic/development/LoadSensorPrototype.wrl#LoadSensor"
  "LoadSensorPrototype.x3d#LoadSensor"
  "https://www.web3d.org/x3d/content/examples/Basic/development/LoadSensorPrototype.x3d#LoadSensor"
]

    
# [Scene] ========== ========== ==========

NavigationInfo { type [ "EXAMINE" "ANY" ] } ###  Default X3D NavigationInfo

WorldInfo {
  title "LoadSensor.x3d"
}
DEF ViewAll Viewpoint {
  description "LoadSensor test"
  position 0 0 12
}
DEF HelloWorld Inline {
  url [ "../HelloWorld.x3d" "https://www.web3d.org/x3d/content/examples/HelloWorld.x3d" ]
}
DEF InlineLoadSensor LoadSensor {
  timeOut 5
  watchList [
    USE HelloWorld
  ]
}
DEF PivotTextSigns Transform {
  translation 0 3 0
  children [
      # First sign indicates waiting...
      Shape {
        geometry Text {
          length [ 0 ]
          string [ "LoadSensor waiting for HelloWorld scene..." ]
          fontStyle FontStyle {
            justify [ "MIDDLE" "MIDDLE"  ] 
            size 0.7
            style "ITALIC"
          }
        }
        appearance Appearance {
          material Material {
            emissiveColor 0.878431 0.262745 0
          }
        }
      }
      # Second sign indicates completed, initially rotated 90 degrees out of view
      Transform {
        rotation 0 1 0 1.57
        children [
            Shape {
              geometry Text {
                length [ 0 ]
                string [ "LoadSensor reports HelloWorld scene loading complete." ]
                fontStyle FontStyle {
                  justify [ "MIDDLE" "MIDDLE"  ] 
                  size 0.7
                  style "ITALIC"
                }
              }
              appearance Appearance {
                material Material {
                  emissiveColor 0 0.278431 0.027451
                }
              }
            }
        ]
      }
  ]
}
DEF SignRotationInterpolator OrientationInterpolator {
  key [ 0 1 ]
  keyValue [ 0 1 0 0 0 1 0 -1.57 ]
}
DEF SignRotationClock TimeSensor {
  cycleInterval 0.8
}
ROUTE InlineLoadSensor.loadTime TO SignRotationClock.set_startTime
ROUTE SignRotationClock.fraction_changed TO SignRotationInterpolator.set_fraction
ROUTE SignRotationInterpolator.value_changed TO PivotTextSigns.set_rotation
DEF TraceScript Script {
  eventIn      SFBool	eventLoaded
  eventIn      SFTime	loadTimeEvent

	url [ "javascript: // ### X3D Browser.print() not supported by all VRML97 viewers, instead simply using print()

function eventLoaded (value)
{
	printingln ('InlineLoadSensor isLoaded=' + value);
}
function loadTimeEvent (value)
{
	printingln ('InlineLoadSensor loadTime=' + value);
}

    
" ]
}
ROUTE InlineLoadSensor.isLoaded TO TraceScript.eventLoaded
ROUTE InlineLoadSensor.loadTime TO TraceScript.loadTimeEvent
