#VRML V2.0 utf8
# X3D-to-VRML-97 XSL translation autogenerated by X3dToVrml97.xslt
# https://www.web3d.org/x3d/content/X3dToVrml97.xslt
# Generated using XSLT processor: Saxonica

# [X3D] VRML V3.3 utf8
# PROFILE Immersive
# [X3D] version=3.3
# [X3D] noNamespaceSchemaLocation=https://www.web3d.org/specifications/x3d-3.3.xsd
# [head]

# META "title" "SoundLoadSensorTest.x3d"
# META "description" "UsingLoadSensor to test when AudioClip loading is complete"
# META "created" "19 July 2008"
# META "modified" "20 October 2019"
# META "creator" "Leonard Daly and Don Brutzman"
# META "reference" "https://X3dGraphics.com"
# META "reference" "https://www.web3d.org/x3d/content/examples/X3dResources.html"
# META "rights" "Copyright 2006, Daly Realism and Don Brutzman"
# META "subject" "X3D book, X3D graphics, X3D-Edit, http://www.x3dGraphics.com"
# META "identifier" "https://X3dGraphics.com/examples/X3dForWebAuthors/Chapter12EnvironmentSensorSound/SoundLoadSensorTest.x3d"
# META "generator" "X3D-Edit 3.3, https://savage.nps.edu/X3D-Edit"
# META "license" "../license.html"


EXTERNPROTO LoadSensor [
  # [appinfo] LoadSensor monitors the progress and success of downloading URL elements over a network. Only nodes that contain a valid URL field (i.e., descendants of X3DUrlObject), may be specified as watchList children. Multiple nodes may be watched with a single LoadSensor.
  # documentation: https://www.web3d.org/specifications/ISO-IEC-19775/Part01/components/networking.html#LoadSensor exposedField SFBool enabled # [appinfo] Enables/disables the sensor node.
  exposedField SFTime timeOut # [appinfo] Maximum time for which the LoadSensor will monitor loading, starting from when the sensor becomes active. timeOut=0 ordinarily indicates an indefinite time out period; i.e., the LoadSensor will wait until loading has completed either with success or failure timeOut=0 causes immediate loading for this implementation.
  field MFNode watchList # [appinfo] Zero or more nodes with url fields to monitor.
  eventIn MFNode set_watchList # [appinfo] Change watchList MFNode array.
  eventOut SFBool isActive # [appinfo] isActive=true when loading begins, isActive=false when loading ends.
  eventOut SFBool isLoaded # [appinfo] isLoaded=true when loading succeeds, isLoaded=false when loading fails or timeOut reached.
  eventOut SFTime loadTime # [appinfo] loadTime event is generated when loading has successfully completed.
  eventOut SFFloat progress # [appinfo] progress [0..1] indicates fraction of loading complete.
  field SFNode metadata # [appinfo] associated Metadata node.
][
  "LoadSensorPrototype.wrl#LoadSensor"
  "https://www.web3d.org/x3d/content/examples/Basic/development/LoadSensorPrototype.wrl#LoadSensor"
  "LoadSensorPrototype.x3d#LoadSensor"
  "https://www.web3d.org/x3d/content/examples/Basic/development/LoadSensorPrototype.x3d#LoadSensor"
]

    
# [Scene] ========== ========== ==========

NavigationInfo { type [ "EXAMINE" "ANY" ] } ###  Default X3D NavigationInfo

# Sound location y-value is 1.6 in order to match typical avatar height (in meters)
WorldInfo {
  title "SoundLoadSensorTest.x3d"
}
DEF SomeSound Sound {
  location 0 1.6 0
  maxBack 100
  maxFront 100
  minBack 10
  minFront 10
  source DEF WaterSounds AudioClip {
    description "Running Water"
    url [ "aqua.wav" "https://X3dGraphics.com/examples/X3dForWebAuthors/Chapter12EnvironmentSensorSound/aqua.wav" ]
  }
}
DEF ReportWhenLoaded LoadSensor {
  watchList [
    USE WaterSounds
  ]
}
ROUTE ReportWhenLoaded.loadTime TO WaterSounds.startTime
# send completion report to console
DEF ConsoleReport Script {
  eventIn      SFBool	loadComplete
  eventIn      SFTime	loadTime

	url [ "javascript: // ### X3D Browser.print() not supported by all VRML97 viewers, instead simply using print()

function initialize ()
{
	printingln ('Script initialize() complete');
}
function loadComplete (value)
{
	printingln ('LoadSensor AudioClip isLoaded=' + value);
}
function loadTime (value)
{
	printingln ('LoadSensor AudioClip loadTime=' + value);
}

    
" ]
}
ROUTE ReportWhenLoaded.isLoaded TO ConsoleReport.loadComplete
ROUTE ReportWhenLoaded.loadTime TO ConsoleReport.loadTime
# show visible indication of load waiting, complete
DEF PivotTextSigns Transform {
  children [
      # First sign indicates waiting...
      Shape {
        geometry Text {
          string [ "LoadSensor waiting for AudioClip..." ]
          fontStyle FontStyle {
            justify [ "MIDDLE" "MIDDLE"  ] 
            size 0.7
            ### style='ITALIC'
          }
        }
        appearance Appearance {
          material Material {
            emissiveColor 0.878431 0.262745 0
          }
        }
      }
      # Second sign indicates completed, initially rotated 90 degrees out of view
      Transform {
        rotation 0 1 0 1.57
        children [
            Shape {
              geometry Text {
                string [ "LoadSensor reports AudioClip loading complete." ]
                fontStyle FontStyle {
                  justify [ "MIDDLE" "MIDDLE"  ] 
                  size 0.7
                  ### style='ITALIC'
                }
              }
              appearance Appearance {
                material Material {
                  emissiveColor 0 0.278431 0.027451
                }
              }
            }
        ]
      }
  ]
}
DEF SignRotationInterpolator OrientationInterpolator {
  key [ 0 1 ]
  keyValue [ 0 1 0 0 0 1 0 -1.57 ]
}
DEF SignRotationClock TimeSensor {
  cycleInterval 0.8
}
ROUTE ReportWhenLoaded.loadTime TO SignRotationClock.startTime
ROUTE SignRotationClock.fraction_changed TO SignRotationInterpolator.set_fraction
ROUTE SignRotationInterpolator.value_changed TO PivotTextSigns.rotation
